 <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Food Avenue</title>
    <link rel="stylesheet" href="checkout.css">

    <!-- Firebase App -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

    <h1>Checkout</h1>

    <!-- Cart Summary -->
    <div class="cart-box">
        <h2>Your Order</h2>
        <ul id="orderSummary"></ul>
        <p>Total: ₦<span id="totalAmount">0</span></p>
    </div>

    <!-- Message placeholder -->
    <div id="message" style="color: red; margin-bottom: 10px;"></div>

    <!-- Delivery Details Form -->
    <form id="orderForm">
        <h2>Delivery Details</h2>
        <input type="text" id="fullName" placeholder="Full Name" required>
        <input type="text" id="phone" placeholder="Phone Number" required>
        <textarea id="address" placeholder="Delivery Address" required></textarea>
        <button type="submit">Place Order</button>
    </form>

    <script>
        // ===== FORMAT NAIRA =====
        function formatNaira(amount) {
            return Number(amount).toLocaleString("en-NG");
        }

        // ===== GENERATE UNIQUE ORDER ID =====
        function generateOrderID() {
            const timestamp = Date.now().toString(36);
            const randomStr = Math.random().toString(36).substring(2, 7);
            return `ORD-${timestamp}-${randomStr}`.toUpperCase();
        }

        // ===== GET CART =====
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        let orderSummary = document.getElementById("orderSummary");
        let totalAmount = 0;

        cart.forEach(item => {
            let itemTotal = item.amount * item.quantity;
            let li = document.createElement("li");
            li.textContent = `${item.food} x ${item.quantity} - ₦${formatNaira(itemTotal)}`;
            orderSummary.appendChild(li);
            totalAmount += itemTotal;
        });

        document.getElementById("totalAmount").innerText = formatNaira(totalAmount);

        // ===== FIREBASE CONFIG =====
        const firebaseConfig = {
            apiKey: "AIzaSyCqaaO2ffQD5WjAsoQ12kmrTyjz8JG-NYY",
            authDomain: "food-avenue-orders.firebaseapp.com",
            projectId: "food-avenue-orders",
            storageBucket: "food-avenue-orders.firebasestorage.app",
            messagingSenderId: "497081436982",
            appId: "1:497081436982:web:90cd3ddad8faa97d650197",
            measurementId: "G-JLRQFS3BSJ"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const messageDiv = document.getElementById("message");

        document.getElementById("orderForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            if (cart.length === 0) {
                messageDiv.textContent = "Your cart is empty. Please add items before placing an order.";
                return;
            }

            messageDiv.textContent = "";

            let orderID = generateOrderID();
            let order = {
                id: orderID,
                name: document.getElementById("fullName").value,
                phone: document.getElementById("phone").value,
                address: document.getElementById("address").value,
                cart: cart,
                total: totalAmount,
                time: new Date().toLocaleString()
            };

            console.log("Submitting order to Firebase:", order);

            try {
                await db.collection("orders").doc(orderID).set(order);
                console.log("Order successfully sent to Firebase!");
            } catch (error) {
                console.error("Firebase error:", error);
                messageDiv.textContent = "Failed to submit order. Please try again.";
                return; // stop redirect if Firebase fails
            }

            // Save to localStorage
            let orders = JSON.parse(localStorage.getItem("orders")) || [];
            orders.push(order);
            localStorage.setItem("orders", JSON.stringify(orders));

            // Clear cart
            localStorage.removeItem("cart");

            // Redirect to success page
            window.location.href = "order-succes.html";
        });
    </script>

</body>
</html>
  ddddddd